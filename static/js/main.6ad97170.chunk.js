(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1147:function(e,t){},1186:function(e,t){},1229:function(e,t){},1265:function(e,t){},1472:function(e,t){},1519:function(e,t){},1543:function(e,t){},1578:function(e,t){},1605:function(e,t){},1635:function(e,t){},1647:function(e,t){},1649:function(e,t){},1660:function(e,t){},1693:function(e,t){},1730:function(e,t){},1764:function(e,t){},1794:function(e,t){},1853:function(e,t){},1882:function(e,t){},1925:function(e,t){},1936:function(e,t){},1938:function(e,t){},1966:function(e,t){},1981:function(e,t){},2014:function(e,t){},2068:function(e,t){},2099:function(e,t,n){},2101:function(e,t,n){},2108:function(e,t,n){},2110:function(e,t,n){},2112:function(e,t,n){},2114:function(e,t,n){},2117:function(e,t,n){"use strict";n.r(t);var a=n(4),r=n.n(a),s=n(861),i=n.n(s),c=(n(880),n(882),n(68)),o=n(69),l=n(71),u=n(70),d=n(72),h=n(2118),p=n(862),f=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return r.a.createElement(h.a,{basename:"/dchat"},r.a.createElement(p.a,null))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(f,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},440:function(e,t,n){"use strict";n.d(t,"a",function(){return m}),n.d(t,"b",function(){return b});var a=n(441),r=n.n(a),s=n(73),i=n(865),c=n(442),o=n.n(c),l=n(866),u=n.n(l),d=n(67),h=n(63),p=n.n(h),f=n(443),g=n.n(f);function m(e){return new Promise(function(t,n){e||(e=o.a.generateMnemonic());var a=o.a.mnemonicToSeed(e,"da-bears-da-champs"),r=u.a.hmac.create("fat-ass-seed");r.update(a);var s=new Uint8Array(r.array());d.keys.generateKeyPairFromSeed("ed25519",s,function(n,a){p.a.createFromPubKey(d.keys.marshalPublicKey(a.public),function(n,a){t({mnemonic:e,peerId:a._idB58String})})})})}var y=function(){var e=Object(i.a)(r.a.mark(function e(t){var n,a,i=arguments;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},a=Object(s.a)({hash:"SHA256",hmacSeed:"ob-hash"},n),e.abrupt("return",new Promise(function(e,n){d.hmac.create(a.hash,g.a.decodeUTF8(a.hmacSeed),function(a,r){a?n(a):r.digest(g.a.decodeUTF8(t),function(t,a){t?n(t):e(a)})})}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}();function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;return new Promise(function(n,a){y(e,{hmacSeed:"ob-identity"}).then(function(e){d.keys.generateKeyPairFromSeed("ed25519",e,t,function(e,t){e?a(e):p.a.createFromPubKey(d.keys.marshalPublicKey(t.public),function(e,a){n({peerId:a.toBytes(),publicKey:t.public.bytes,privateKey:t.bytes})})})},function(e){return a(e)})})}},444:function(e,t,n){"use strict";var a=n(79),r=n(68),s=n(69),i=n(71),c=n(70),o=n(72),l=n(36),u=n(4),d=n.n(u),h=n(227),p=(n(859),n(860),n(2108),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(i.a)(this,Object(c.a)(t).call(this,e))).state={seed:""},n.handleInputChange=n.handleInputChange.bind(Object(l.a)(Object(l.a)(n))),n}return Object(o.a)(t,e),Object(s.a)(t,[{key:"handleInputChange",value:function(e){var t=e.target,n="checkbox"===t.type?t.checked:t.value,r=t.name;this.setState(Object(a.a)({},r,n))}},{key:"render",value:function(){var e=this;return d.a.createElement("div",{className:"Login"},d.a.createElement("h1",{className:"rowLg txRt"},"Who be you?"),d.a.createElement("input",{type:"text",placeholder:"Enter your seed",className:"width100 rowMd",name:"seed",onChange:this.handleInputChange}),d.a.createElement("div",{className:"flexVCent"},d.a.createElement("div",{className:"flexNoShrink"},d.a.createElement(h.a,{to:"/register"},"I don't have a seed \ud83d\ude1e")),d.a.createElement("div",{className:"flexHRight"},d.a.createElement("button",{onClick:function(){return e.props.onLogin(e.state.seed)}},"Login"))))}}]),t}(u.Component));t.a=p},560:function(e,t){},609:function(e,t){},859:function(e,t,n){},860:function(e,t,n){},862:function(e,t,n){"use strict";(function(e){var a=n(79),r=n(445),s=n(73),i=n(68),c=n(69),o=n(71),l=n(70),u=n(72),d=n(36),h=n(4),p=n.n(h),f=n(140),g=n(874),m=n(2119),y=n(225),b=n.n(y),v=n(226),E=n.n(v),O=n(863),C=n.n(O),j=n(864),I=n.n(j),S=n(63),k=n(439),N=n(14),R=n.n(N),w=n(10),T=n.n(w),P=n(440),x=n(867),L=(n(2099),n(868)),D=n(444),A=n(869),_=n(870),M=n(871),F=function(t){function n(e){var t;return Object(i.a)(this,n),(t=Object(o.a)(this,Object(l.a)(n).call(this,e))).state={registerSeed:null,registerSeedError:null,userId:null,chats:{}},t.handleLogin=t.handleLogin.bind(Object(d.a)(Object(d.a)(t))),t.handleRegenerate=t.handleRegenerate.bind(Object(d.a)(Object(d.a)(t))),t.handleStartChat=t.handleStartChat.bind(Object(d.a)(Object(d.a)(t))),t.handleChatSend=t.handleChatSend.bind(Object(d.a)(Object(d.a)(t))),t.generateRegisterSeed(),t}return Object(u.a)(n,t),Object(c.a)(n,[{key:"getIpfsNodeInitOpts",value:function(e,t){if("string"!==typeof e)throw new Error("Please provide a peerId as a string.");if("string"!==typeof t)throw new Error("Please provide a privateKey as a string.");return{EXPERIMENTAL:{pubsub:!0},relay:{enabled:!0,hop:{enabled:!0}},repo:"./ipfs/".concat(e),init:{privateKey:t}}}},{key:"handleLogin",value:function(e){var t=this;e&&"string"===typeof e||alert("I'm gonna need a seed slick willy!"),Object(P.b)(e).then(function(n){var i=Object(S.createFromBytes)(n.peerId).toB58String(),c=Object(k.fromByteArray)(n.privateKey);console.log('A seed of "'.concat(e.slice(0,25),'\u2026" gets you this peerId: ').concat(i));var o=t.getIpfsNodeInitOpts(i,c),l=new I.a(o);l.on("ready",function(){l.libp2p.start(function(){t.node=l,t.setState({userId:i}),console.log("connecting to the relay peer at ".concat(t.ipfsRelayPeer)),l.swarm.connect(t.ipfsRelayPeer,function(e){if(e)return alert("Unable to connect to the relay peer. Are you sure it's  running?"),console.error(e);console.log("connected to relay peer")}),l._libp2pNode.handle("dabears/1",function(e,n){console.log("pulling in incoming message"),T()(n,T.a.collect(function(e,n){if(e)return console.error("There was an error pulling in an incoming chat message:",e);var i=JSON.parse(n[0]);console.dir(i);var c=t.state.chats[i.peerId]||t.defaultChat,o=Object(s.a)({},c,{messages:Object(r.a)(c.messages).concat([{id:i.messageId,outgoing:!1,msg:i.message,sending:!1,failed:!1}])});t.setState({chats:Object(s.a)({},t.state.chats,Object(a.a)({},i.peerId,o))}),console.dir({chats:Object(s.a)({},t.state.chats,Object(a.a)({},i.peerId,o))})}))})})})}).catch(function(e){alert("There was an error generating your peerId: ".concat(e.message))})}},{key:"handleRegenerate",value:function(){this.generateRegisterSeed()}},{key:"handleStartChat",value:function(e){"string"===typeof e&&e.startsWith("Qm")?e===this.state.userId?alert("We cannot condone chatting with yourself. Please try again."):this.props.history.push("/chat/".concat(e)):alert("Please provide a valid peer id.")}},{key:"getChatPayload",value:function(t){if("string"!==typeof t)throw new Error("Please provide a message as a string.");var n=new Date,a="".concat("","!").concat(n.toISOString()),r=E.a.createHash("sha256").update(a).digest(),s=new Uint8Array(r),i=new e(s.buffer),c=R.a.encode(i,18);return{messageId:R.a.toB58String(c),subject:"",message:t,timestamp:{seconds:Math.floor(n/1e3),nanos:0},flag:0}}},{key:"handleChatSend",value:function(e,t){var n=this;if("string"!==typeof e||!e.startsWith("Qm"))throw new Error("I need a peerId to send to.");if("string"===typeof t&&t){var i=this.state.chats[e];if(i){var c=b()(),o=this.state.userId;this.setState({chats:Object(s.a)({},this.state.chats,Object(a.a)({},e,Object(s.a)({},i,{messages:Object(r.a)(i.messages).concat([{id:c,outgoing:!0,msg:t,sending:!0}])})))});var l=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n.setState({chats:Object(s.a)({},n.state.chats,Object(a.a)({},e,Object(s.a)({},n.state.chats[e],{messages:n.state.chats[e].messages.map(function(e){return e.id===c?Object(s.a)({},e,{failed:t,sending:!1}):e})})))})},u="/p2p-circuit/ipfs/".concat(e);console.log("will send to ".concat(e," at ").concat(u)),this.node.swarm.connect(u,function(a){if(a)return l(!0),console.error(a);console.log("connected to ".concat(e)),n.node._libp2pNode.dialProtocol(u,"dabears/1",function(e,a){if(e)return l(!0),console.error(e);var r=n.getChatPayload(t),i=JSON.stringify(Object(s.a)({},r,{peerId:o}));console.log("pushing outgoing message"),T()(T.a.once(i),a,T.a.collect(function(e,t){if(e)return console.error(e);console.log("received echo:",t.toString())})),l()})})}}else alert("Please provide a message.")}},{key:"generateRegisterSeed",value:function(){var e=this;Object(P.a)().then(function(t){return e.setState({registerSeed:t.mnemonic,registerSeedError:null})},function(t){e.setState({registerSeed:null,registerSeedError:t}),console.error("There was an error generating the register seed.",t)})}},{key:"requiresLogin",value:function(e,t){var n=this;return function(a){var r=Object(s.a)({},a,t);return n.isLoggedIn?p.a.createElement(e,r):p.a.createElement(D.a,{onLogin:n.handleLogin})}}},{key:"render",value:function(){var e=this,t=this.isLoggedIn?"/start-chat/":"/login/",n=this.state.chats;return p.a.createElement("div",{className:"App"},p.a.createElement(L.a,{chats:Object.keys(n)}),p.a.createElement("div",{className:"mainContent"},p.a.createElement(f.a,{path:"/",exact:!0,render:function(){return p.a.createElement(g.a,{to:t})}}),p.a.createElement(f.a,{path:"/login/",exact:!0,render:function(){return e.isLoggedIn?p.a.createElement(g.a,{to:"/start-chat/"}):p.a.createElement(D.a,{onLogin:e.handleLogin})}}),p.a.createElement(f.a,{path:"/register/",exact:!0,render:function(t){return p.a.createElement(A.a,{seed:e.state.registerSeed,onRegenerate:e.handleRegenerate})}}),p.a.createElement(f.a,{path:"/start-chat/",exact:!0,render:this.requiresLogin(_.a,{onStartChat:this.handleStartChat})}),p.a.createElement(f.a,{path:"/chat/:receiver",exact:!0,render:function(t){var n=t.match.params.receiver,a=e.state.chats[n]=e.state.chats[n]||e.defaultChat;return e.requiresLogin(M.a,Object(s.a)({},t,a,{receiver:n,onChatSend:e.handleChatSend}))(t)}})))}},{key:"ipfsRelayPeer",get:function(){return"/dns4/webchat.ob1.io/tcp/9999/wss/ipfs/QmSAumietCn85sF68xgCUtVS7UuZbyBi5LQPWqLe4vfwYb"}},{key:"root",get:function(){return this._rootPB||(this._rootPB=C.a.Root.fromJSON(x)),this._rootPB}},{key:"ChatPB",get:function(){return this._ChatPB||(this._ChatPB=this.root.lookupType("Chat")),this._ChatPB}},{key:"isLoggedIn",get:function(){return!!this.state.userId}},{key:"defaultChat",get:function(){return{isTyping:!1,messages:[]}}}]),n}(h.Component);t.a=Object(m.a)(F)}).call(this,n(0).Buffer)},867:function(e){e.exports={options:{go_package:"pb"},nested:{Message:{fields:{messageType:{type:"MessageType",id:1},payload:{type:"google.protobuf.Any",id:2},requestId:{type:"int32",id:3},isResponse:{type:"bool",id:4}},nested:{MessageType:{values:{PING:0,CHAT:1,FOLLOW:2,UNFOLLOW:3,ORDER:4,ORDER_REJECT:5,ORDER_CANCEL:6,ORDER_CONFIRMATION:7,ORDER_FULFILLMENT:8,ORDER_COMPLETION:9,DISPUTE_OPEN:10,DISPUTE_UPDATE:11,DISPUTE_CLOSE:12,REFUND:13,OFFLINE_ACK:14,OFFLINE_RELAY:15,MODERATOR_ADD:16,MODERATOR_REMOVE:17,STORE:18,BLOCK:19,VENDOR_FINALIZED_PAYMENT:20,ERROR:500}}}},Envelope:{fields:{message:{type:"Message",id:1},pubkey:{type:"bytes",id:2},signature:{type:"bytes",id:3}}},Chat:{fields:{messageId:{type:"string",id:1},subject:{type:"string",id:2},message:{type:"string",id:3},timestamp:{type:"google.protobuf.Timestamp",id:4},flag:{type:"Flag",id:5}},nested:{Flag:{values:{MESSAGE:0,TYPING:1,READ:2}}}},SignedData:{fields:{senderPubkey:{type:"bytes",id:1},serializedData:{type:"bytes",id:2},signature:{type:"bytes",id:3}},nested:{Command:{fields:{peerID:{type:"string",id:1},type:{type:"Message.MessageType",id:2},timestamp:{type:"google.protobuf.Timestamp",id:3}}}}},CidList:{fields:{cids:{rule:"repeated",type:"string",id:1,options:{packed:!0}}}},Block:{fields:{rawData:{type:"bytes",id:1},cid:{type:"string",id:2}}},Error:{fields:{code:{type:"uint32",id:1},errorMessage:{type:"string",id:2},orderID:{type:"string",id:3}}},google:{nested:{protobuf:{nested:{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}}}}}}},868:function(e,t,n){"use strict";var a=n(68),r=n(69),s=n(71),i=n(70),c=n(72),o=n(4),l=n.n(o),u=n(873),d=(n(2101),function(e){function t(){return Object(a.a)(this,t),Object(s.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return l.a.createElement("nav",{className:"SiteNav flexVCent gutterH"},l.a.createElement("div",{className:"logo"},l.a.createElement("div",null,"\ud83c\udde9"),"CHAT")," :",l.a.createElement("div",null,l.a.createElement(u.a,{to:"/start-chat/",activeClassName:"active"},"\ud83d\udcac New Chat")),this.props.chats.map(function(e){return l.a.createElement("div",{key:e},l.a.createElement(u.a,{to:"/chat/".concat(e),activeClassName:"active"},e.slice(0,10),"\u2026"))}))}}]),t}(o.Component));t.a=d},869:function(e,t,n){"use strict";var a=n(68),r=n(69),s=n(71),i=n(70),c=n(72),o=n(4),l=n.n(o),u=n(227),d=(n(859),n(860),n(2110),function(e){function t(){return Object(a.a)(this,t),Object(s.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this,t=this.props.seed;return t||(t=l.a.createElement("div",{className:"center"},"Generating\u2026")),l.a.createElement("div",{className:"Register"},l.a.createElement("h1",{className:"rowLg txRt"},"You do now!"),l.a.createElement("div",{className:"border seed rowMd"},t),l.a.createElement("div",{className:"flexVCent"},l.a.createElement("div",{className:"flexNoShrink"},l.a.createElement("a",{onClick:function(){return e.props.onRegenerate()}},"Re-generate")),l.a.createElement("div",{className:"flexHRight"},l.a.createElement(u.a,{to:"/login/"},"\u2b05\ufe0fBack"))))}}]),t}(o.Component));t.a=d},870:function(e,t,n){"use strict";var a=n(79),r=n(68),s=n(69),i=n(71),c=n(70),o=n(72),l=n(36),u=n(4),d=n.n(u),h=(n(2112),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(i.a)(this,Object(c.a)(t).call(this,e))).state={receiverPeerId:""},n.handleInputChange=n.handleInputChange.bind(Object(l.a)(Object(l.a)(n))),n}return Object(o.a)(t,e),Object(s.a)(t,[{key:"handleInputChange",value:function(e){var t=e.target,n="checkbox"===t.type?t.checked:t.value,r=t.name;this.setState(Object(a.a)({},r,n))}},{key:"render",value:function(){var e=this;return d.a.createElement("div",{className:"StartConvo"},d.a.createElement("h1",{className:"rowLg txRt"},"Who ya wanna chat with?"),d.a.createElement("input",{type:"text",placeholder:"Enter a peerId",className:"width100 rowMd",name:"receiverPeerId",onChange:this.handleInputChange}),d.a.createElement("div",{className:"flex"},d.a.createElement("div",{className:"flexHRight"},d.a.createElement("button",{onClick:function(){return e.props.onStartChat(e.state.receiverPeerId)}},"Chat"))))}}]),t}(u.Component));t.a=h},871:function(e,t,n){"use strict";var a=n(79),r=n(68),s=n(69),i=n(71),c=n(70),o=n(72),l=n(36),u=n(4),d=n.n(u),h=(n(2114),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(i.a)(this,Object(c.a)(t).call(this,e))).state={chatText:""},n.handleInputChange=n.handleInputChange.bind(Object(l.a)(Object(l.a)(n))),n.handleChatTextKeyUp=n.handleChatTextKeyUp.bind(Object(l.a)(Object(l.a)(n))),n.messagesRef=d.a.createRef(),n}return Object(o.a)(t,e),Object(s.a)(t,[{key:"handleInputChange",value:function(e){var t=e.target,n="checkbox"===t.type?t.checked:t.value,r=t.name;this.setState(Object(a.a)({},r,n))}},{key:"handleChatTextKeyUp",value:function(e){13===e.keyCode&&(this.setState({chatText:""}),this.props.onChatSend(this.props.receiver,this.state.chatText))}},{key:"componentDidMount",value:function(){var e=this.messagesRef.current;e.scrollTop=e.scrollHeight}},{key:"componentWillReceiveProps",value:function(e){var t=this.messagesRef.current,n=this.props.messages[this.props.messages.length-1],a=e.messages[e.messages.length-1];a&&(!n||n.id!==a.id)&&t.scrollTop>=t.scrollHeight-t.offsetHeight-15&&(this.scrollTo=t.scrollHeight)}},{key:"componentDidUpdate",value:function(){var e=this.messagesRef.current;"number"===typeof this.scrollTo&&(e.scrollTop=this.scrollTo),this.scrollTo=null}},{key:"render",value:function(){var e=this,t=this.props.messages.find(function(e){return e.failed})?d.a.createElement("div",{className:"failedInfo"},d.a.createElement("a",{onClick:function(){return alert("The most likely reason in the person you are chatting with is offline. This app does not support offline messages at this time. If you are sure the other party is online, it's possible that both your ports are blocked and you are unable to connect to the relay server.")}},"Why have some of my messages failed?")):null;return d.a.createElement("div",{className:"Conversation"},d.a.createElement("div",{className:"chatContent rowLg"},d.a.createElement("h1",null,this.props.receiver.slice(0,20),this.props.receiver.length>20?"\u2026":""),d.a.createElement("ul",{className:"messages unstyled",ref:this.messagesRef},this.props.messages.map(function(e){var t=null;e.sending?t=d.a.createElement("span",null,"\ud83d\udce1"):e.failed&&(t=d.a.createElement("span",null,"\u274c"));var n=e.outgoing?"outgoing":"";return d.a.createElement("div",{className:n,key:e.id},d.a.createElement("div",{className:"status"},t),d.a.createElement("li",null,e.msg))})),d.a.createElement("div",{className:"flexVCent gutterH"},d.a.createElement("div",{className:"flexExpand"},d.a.createElement("input",{type:"text",className:"width100",placeholder:"Say something clever...",name:"chatText",value:this.state.chatText,onChange:this.handleInputChange,onKeyUp:this.handleChatTextKeyUp})),d.a.createElement("div",null,d.a.createElement("div",{className:"flexHRight"},d.a.createElement("button",{onClick:function(){e.setState({chatText:""}),e.props.onChatSend(e.props.receiver,e.state.chatText)}},"Send"))))),t)}}]),t}(u.Component));t.a=h},875:function(e,t,n){e.exports=n(2117)},882:function(e,t,n){},884:function(e,t){},886:function(e,t){},918:function(e,t){},919:function(e,t){}},[[875,2,1]]]);
//# sourceMappingURL=main.6ad97170.chunk.js.map